<?xml version="1.0" encoding="UTF-8"?>
<!-- LICENSE_PLACEHOLDER -->
<izpack:installation version="5.0"
	xmlns:izpack="http://izpack.org/schema/installation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://izpack.org/schema/installation http://izpack.org/schema/5.0/izpack-installation-5.0.xsd">

	<info>
		<appname>REGARDS</appname>
		<appversion>@{project.version}</appversion>
		<appsubpath>regards</appsubpath>
		<javaversion>@{java.version}</javaversion>
		<requiresjdk>no</requiresjdk>
		<url>https://github.com/regards</url>
		<!-- TODO GBN -->
		<!-- <authors/> -->
		<!-- <uninstaller> -->
	</info>

	<locale>
		<langpack iso3="eng" />
	</locale>

	<guiprefs width="800" height="600" resizable="no">
		<laf name="substance">
			<os family="unix" />
			<param name="variant" value="graphite" />
		</laf>
		<laf name="substance">
			<os family="windows" />
			<param name="variant" value="windows" />
		</laf>
		<laf name="substance">
			<os family="mac" />
			<param name="variant" value="mist-aqua" />
		</laf>
		<modifier key="useButtonIcons" value="no" />
		<modifier key="useLabelIcons" value="no" />
		<modifier key="labelGap" value="2" />
		<modifier key="layoutAnchor" value="NORTHWEST" />
		<modifier key="useHeadingPanel" value="yes" />
		<modifier key="headingImageOnLeft" value="yes" />
		<modifier key="headingLineCount" value="1" />
		<modifier key="headingFontSize" value="1.5" />
		<modifier key="headingBackgroundColor" value="0x00ffffff" />
		<modifier key="headingPanelCounter" value="text" />
		<modifier key="headingPanelCounterPos" value="inHeading" />
		<!-- Show the splashScreen for a minimum of 1000 milliseconds -->
		<modifier key="useSplashScreen" value="3000" />
	</guiprefs>

	<resources>
		<res id="InfoPanel.info" src="doc/readme.txt" parse="yes" />
		<res id="LicencePanel.licence" src="legal/License.txt" />

		<!--Define the splash screen image as a reading just like a heading image -->
		<res id="Splash.image" src="images/splash.jpg" />
		<res id="userInputSpec.xml" src="userInputSpec.xml" parse="yes" type="xml"/>
		<res id="userInputLang.xml_eng" src="userInputLang.xml_eng" />
	</resources>

	<dynamicvariables>
		<!-- Common -->
		<variable name="regards.config.cloud.config.port" value="8888" />
		
		<!-- Config microservice -->
		<variable name="regards.config.service.registry.uri" value="localhost" />
		<variable name="regards.config.service.registry.port" value="8761" />
		<variable name="regards.config.spring.rabbitmq.addresses" value="172.26.47.52:5672" />
		<variable name="regards.config.spring.rabbitmq.username" value="guest" />
		<variable name="regards.config.spring.rabbitmq.password" value="guest" />
		<variable name="regards.config.regards.amqp.management.host" value="172.26.47.52" />
		<variable name="regards.config.regards.amqp.management.port" value="15672" />
		<variable name="regards.config.admin.regards.accounts.root.user.login" value="regards-admin@c-s.fr" />
		<variable name="regards.config.admin.regards.accounts.root.user.password" value="root_admin" />
		
		<!-- Internal Izpack variables -->
		<variable name="frontend.selected" value="true" />
		<variable name="registry.selected" value="true" />
		<variable name="config.selected" value="true"/>
		<variable name="gateway.selected" value="true" />
		<variable name="microservices.admin.selected" value="true" />
		<variable name="microservices.dam.selected" value="true" />
		<variable name="microservices.catalog.selected" value="true" />
		<variable name="microservices.access.selected" value="true" />
		<variable name="microservices.storage.selected" value="true" />
	</dynamicvariables>

	<conditions>
		<condition type="variable" id="isFrontendSelected">
			<name>frontend.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isConfigSelected">
			<name>config.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isRegistrySelected">
			<name>registry.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isGatewaySelected">
			<name>gateway.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isMicroservicesAdminSelected">
			<name>microservices.admin.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isMicroservicesDataManagementSelected">
			<name>microservices.dam.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isMicroservicesCatalogSelected">
			<name>microservices.catalog.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isMicroservicesAccessSelected">
			<name>microservices.access.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isMicroservicesStorageSelected">
			<name>microservices.storage.selected</name>
			<value>true</value>
		</condition>
	</conditions>

	<panels>
		<panel classname="HelloPanel" />
		<panel classname="TargetPanel" />
		<panel classname="UserInputPanel" id="SelectComponentsPanel" />
		<panel classname="UserInputPanel" id="CommonConfigPanel" />
		<panel classname="UserInputPanel" id="RegistryConfigPanel" condition="isConfigSelected" />
<!-- TODO GBN : Finir les config -->
<!-- 		<panel classname="UserInputPanel" id="GatewayConfigPanel" condition="isConfigSelected" /> -->
		<panel classname="SummaryPanel" />
		<panel classname="InstallPanel" />
		<panel classname="SimpleFinishPanel" />
	</panels>
	<packs>
		<pack name="core" required="yes">
			<description>REGARDS Installation</description>

			<file targetdir="$INSTALL_PATH" src="doc/readme.txt" override="true"/>
			<file targetdir="$INSTALL_PATH" src="legal/License.txt" override="true"/>

			<file targetdir="$INSTALL_PATH/REGARDS/config" src="config/BOOT-INF/classes/application.properties" override="true"/>

			<!-- This file contains placeholder variables starting with $ that Izpack 
				substitutes with values that the user enters during installation in the UserInputPanel -->
			<parsable type="javaprop" targetfile="$INSTALL_PATH/REGARDS/config/application.properties"/>
		</pack>
		<pack name="config" required="no" condition="isConfigSelected">
			<description>REGARDS Configuration service installation</description>

			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true">
				<include name="bootstrap-config.jar" />
			</fileset>
			
			<fileset dir="config/BOOT-INF/classes/regards" targetdir="$INSTALL_PATH/REGARDS/config/regards" override="true">
				<include name="*" />
			</fileset>

			<!-- This file contains placeholder variables starting with $ that Izpack 
				substitutes with values that the user enters during installation in the UserInputPanel -->
			<!-- WARNING the fileset izpack functionality does'nt work for parsable with izpack 5.0.6 to 5.0.10 -->
			<parsable type="javaprop" targetfile="$INSTALL_PATH/REGARDS/config/regards/application.properties"/>
			<parsable type="javaprop" targetfile="$INSTALL_PATH/REGARDS/config/regards/rs-registry.properties"/>
			<parsable type="javaprop" targetfile="$INSTALL_PATH/REGARDS/config/regards/rs-gateway.properties"/>
			<parsable type="javaprop" targetfile="$INSTALL_PATH/REGARDS/config/regards/rs-admin.properties"/>
			<parsable type="javaprop" targetfile="$INSTALL_PATH/REGARDS/config/regards/rs-dam.properties"/>
			<parsable type="javaprop" targetfile="$INSTALL_PATH/REGARDS/config/regards/rs-access.properties"/>
<!-- 				<fileset targetdir="$INSTALL_PATH/REGARDS/config/regards"> -->
<!-- 					<include name="application.properties"/> -->
<!-- 				</fileset> -->
<!-- 			</parsable> -->
		</pack>
		<pack name="registry" required="no" condition="isRegistrySelected">
			<description>REGARDS Registry service installation</description>

			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true">
				<include name="bootstrap-registry.jar" />
			</fileset>
		</pack>
		<pack name="gateway" required="no" condition="isGatewaySelected">
			<description>REGARDS Gateway service installation</description>

			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true">
				<include name="bootstrap-gateway.jar" />
			</fileset>
		</pack>
		<pack name="admin" required="no" condition="isMicroservicesAdminSelected">
			<description>REGARDS Administration service installation</description>

			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true">
				<include name="bootstrap-administration.jar" />
			</fileset>
		</pack>
		<pack name="dam" required="no" condition="isMicroservicesDataManagementSelected">
			<description>REGARDS Data Management services installation</description>

			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true">
				<include name="bootstrap-dam.jar" />
			</fileset>
		</pack>
		<pack name="catalog" required="no" condition="isMicroservicesCatalogSelected">
			<description>REGARDS Catalog services installation</description>

			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true">
				<include name="bootstrap-catalog.jar" />
			</fileset>
		</pack>
		<pack name="access" required="no" condition="isMicroservicesAccessSelected">
			<description>REGARDS Access service installation</description>

			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true">
				<include name="bootstrap-access.jar" />
			</fileset>
		</pack>
		<pack name="storage" required="no" condition="isMicroservicesStorageSelected">
			<description>REGARDS Storage service installation</description>

			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true">
				<include name="bootstrap-storage.jar" />
			</fileset>
		</pack>
	</packs>

	<!-- TODO GBN, faire le paquetage -->
	<!-- <packs> -->
	<!-- <pack name="Test Core" required="yes"> -->
	<!-- <description>The core files needed for the application</description> -->
	<!-- <fileset dir="plain" targetdir="${INSTALL_PATH}" override="true"/> -->
	<!-- <parsable targetfile="${INSTALL_PATH}/test.properties"/> -->
	<!-- </pack> -->
	<!-- </packs> -->

</izpack:installation>
