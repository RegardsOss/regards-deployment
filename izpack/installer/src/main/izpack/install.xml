<?xml version="1.0" encoding="UTF-8"?>
<!-- LICENSE_PLACEHOLDER -->
<izpack:installation version="5.0"
	xmlns:izpack="http://izpack.org/schema/installation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://izpack.org/schema/installation http://izpack.org/schema/5.0/izpack-installation-5.0.xsd">

	<info>
		<appname>REGARDS</appname>
		<appversion>@{regards.izpack.panels.version}</appversion>
		<appsubpath>regards</appsubpath>
		<javaversion>@{java.version}</javaversion>
		<requiresjdk>no</requiresjdk>
		<url>https://github.com/regards</url>
		<!-- TODO GBN -->
		<!-- <authors/> -->
		<!-- <uninstaller> -->
	</info>

	<locale>
		<langpack iso3="eng" />
	</locale>

	<logging>
		<log-file pattern="regards_install.log" append="false" level="ALL" />
	</logging>

	<guiprefs width="800" height="600" resizable="no">
		<laf name="looks">
			<os family="unix" />
			<os family="windows" />
			<os family="mac" />
			<param name="variant" value="plastic" />
		</laf>
		<modifier key="useButtonIcons" value="no" />
		<modifier key="useLabelIcons" value="no" />
		<modifier key="labelGap" value="2" />
		<modifier key="layoutAnchor" value="NORTHWEST" />
		<modifier key="useHeadingPanel" value="yes" />
		<modifier key="headingImageOnLeft" value="yes" />
		<modifier key="headingLineCount" value="1" />
		<modifier key="headingFontSize" value="1.5" />
		<modifier key="headingBackgroundColor" value="0x00ffffff" />
		<modifier key="headingPanelCounter" value="text" />
		<modifier key="headingPanelCounterPos" value="inHeading" />
		<!-- Show the splashScreen for a minimum of 3000 milliseconds -->
		<modifier key="useSplashScreen" value="3000" />
	</guiprefs>

	<resources>
		<res id="InfoPanel.info" src="doc/readme.txt" parse="yes" />
		<res id="LicencePanel.licence" src="legal/License.txt" />

		<!--Define the splash screen image as a reading just like a heading image -->
		<res id="Splash.image" src="images/splash.jpg" />
		<res id="userInputSpec.xml" src="userInputSpec.xml" parse="yes" type="xml"/>
		<res id="ProcessPanel.Spec.xml" src="ProcessPanel.Spec.xml" parse="yes" type="xml"/>
		<res id="userInputLang.xml_eng" src="userInputLang.xml_eng" />
	</resources>
	
	<jar src="custom/regards-izpack-panels.jar" stage="install"/>
	<jar src="custom/regards-izpack-utils.jar" stage="install"/>

	<dynamicvariables>
		<!-- Common -->
		<variable name="regards.config.cloud.config.address" value="localhost" />
		<variable name="regards.config.cloud.config.port" value="8888" />
		
		<!-- Config microservice -->
		<variable name="regards.config.spring.rabbitmq.addresses" value="172.26.47.52:5672" />
		<variable name="regards.config.spring.rabbitmq.username" value="guest" />
		<variable name="regards.config.spring.rabbitmq.password" value="guest" />
		<variable name="regards.config.regards.amqp.management.host" value="172.26.47.52" />
		<variable name="regards.config.regards.amqp.management.port" value="15672" />
		<variable name="regards.config.admin.regards.accounts.root.user.login" value="regards-admin@c-s.fr" />
		<variable name="regards.config.admin.regards.accounts.root.user.password" value="root_admin" /><variable name="creature.count" value="0"/>
		
		<!-- Internal variables -->
		<variable name="microservice.registry.count" value="0"/>
		<variable name="microservice.registry.uri" value="localhost" />
		<variable name="microservice.registry.port" value="8761" />
		
		<!-- Internal Izpack variables -->
		<variable name="frontend.selected" value="true" />
		<variable name="microservices.selected" value="true" />
		<variable name="registry.selected" value="false" />
		<variable name="config.selected" value="false"/>
		<variable name="gateway.selected" value="false" />
		<variable name="microservices.admin.selected" value="false" />
		<variable name="microservices.dam.selected" value="false" />
		<variable name="microservices.catalog.selected" value="false" />
		<variable name="microservices.access.selected" value="false" />
		<variable name="microservices.storage.selected" value="false" />
	</dynamicvariables>

	<conditions>
		<condition type="variable" id="isFrontendSelected">
			<name>frontend.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isMicroservicesSelected">
			<name>microservices.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isConfigSelected">
			<name>config.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isRegistrySelected">
			<name>registry.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isGatewaySelected">
			<name>gateway.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isMicroservicesAdminSelected">
			<name>microservices.admin.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isMicroservicesDataManagementSelected">
			<name>microservices.dam.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isMicroservicesCatalogSelected">
			<name>microservices.catalog.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isMicroservicesAccessSelected">
			<name>microservices.access.selected</name>
			<value>true</value>
		</condition>
		<condition type="variable" id="isMicroservicesStorageSelected">
			<name>microservices.storage.selected</name>
			<value>true</value>
		</condition>
		<condition type="and" id="mustInstallRegistry">
			<condition type="ref" refid="isMicroservicesSelected" />
			<condition type="ref" refid="isRegistrySelected" />
		</condition>
	</conditions>

	<panels>
		<panel classname="HelloPanel" />
		<panel classname="InfoPanel" />
		<panel classname="LicencePanel" />
		<panel classname="TargetPanel" />
		<panel classname="UserInputPanel" id="SelectComponentsPanel" />
		<panel classname="UserInputPanel" id="SelectMicroservicesPanel" condition="isMicroservicesSelected" />
		<panel classname="UserInputPanel" id="CommonConfigPanel" />
		<panel classname="UserInputPanel" id="RegistryConfigPanel" condition="isConfigSelected">
			<validator classname="fr.cnes.regards.deployment.izpack.validator.ValidatorRegistryPanel"/>
		</panel>
<!-- TODO GBN : Finir les config -->
<!-- 		<panel classname="UserInputPanel" id="GatewayConfigPanel" condition="isConfigSelected" /> -->
		<panel classname="SummaryPanel" />
		<panel classname="InstallPanel" />
		<panel classname="ProcessPanel" />
		<panel classname="SimpleFinishPanel" />
	</panels>

	<packs>
		<pack name="core" required="yes">
			<description>REGARDS Core installation</description>

			<file targetdir="$INSTALL_PATH" src="doc/readme.txt" override="true"/>
			<file targetdir="$INSTALL_PATH" src="legal/License.txt" override="true"/>
		</pack>
		<pack name="coreMicroservices" required="no" condition="isMicroservicesSelected">
			<description>REGARDS Core microservices installation</description>
			
			<file targetdir="$INSTALL_PATH/REGARDS/config" src="config/bootstrap.properties" override="true"/>
			<fileset dir="bin/" targetdir="$INSTALL_PATH/REGARDS/bin" override="true">
				<include name="*" />
			</fileset>
			<fileset dir="utils/" targetdir="$INSTALL_PATH/REGARDS/lib" override="true">
				<include name="*.jar" />
			</fileset>
			
			<executable type="bin" stage="never" keep="true">
				<fileset targetdir="$INSTALL_PATH/REGARDS/bin" includes="*.groovy,*_microservice.sh" excludes="functions.sh" />
			</executable>

			<!-- This file contains placeholder variables starting with $ that Izpack 
				substitutes with values that the user enters during installation in the UserInputPanel -->
			<parsable type="javaprop" targetfile="$INSTALL_PATH/REGARDS/config/bootstrap.properties"/>
		</pack>
		<pack name="frontend" required="no" condition="isFrontendSelected">
			<description>REGARDS Frontend service installation</description>

			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true">
				<include name="bootstrap-frontend.*ar" />
			</fileset>
		</pack>
		<pack name="config" required="no" condition="isConfigSelected">
			<description>REGARDS Configuration service installation</description>

			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true">
				<include name="bootstrap-config.jar" />
			</fileset>
			
			<fileset dir="config/BOOT-INF/classes/regards" targetdir="$INSTALL_PATH/REGARDS/config/regards" override="true">
				<include name="*" />
			</fileset>

			<!-- This file contains placeholder variables starting with $ that Izpack 
				substitutes with values that the user enters during installation in the UserInputPanel -->
			<parsable type="javaprop">
				<fileset targetdir="$INSTALL_PATH/REGARDS/config/regards">
					<include name="*.properties"/>
				</fileset>
			</parsable>
		</pack>
		<pack name="registry" required="no" condition="mustInstallRegistry">
			<description>REGARDS Registry service installation</description>

			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true">
				<include name="bootstrap-registry.jar" />
			</fileset>

			<executable targetfile="$INSTALL_PATH/REGARDS/bin/create_microservice_confile.groovy"
				type="bin" stage="postinstall" failure="abort" keep="true">
				<os family="unix" />
				<args>
					<arg value="-i"/>
					<arg value="$INSTALL_PATH/REGARDS" />
					<arg value="-t"/>
					<arg value="registry" />
					<arg value="-c"/>
					<arg value="${microservice.registry.microserviceList}" />
				</args>
			</executable>
		</pack>
<!-- 		<pack name="gateway" required="no" condition="isGatewaySelected"> -->
<!-- 			<description>REGARDS Gateway service installation</description> -->

<!-- 			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true"> -->
<!-- 				<include name="bootstrap-gateway.jar" /> -->
<!-- 			</fileset> -->
<!-- 		</pack> -->
<!-- 		<pack name="admin" required="no" condition="isMicroservicesAdminSelected"> -->
<!-- 			<description>REGARDS Administration service installation</description> -->

<!-- 			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true"> -->
<!-- 				<include name="bootstrap-administration.jar" /> -->
<!-- 			</fileset> -->
<!-- 		</pack> -->
<!-- 		<pack name="dam" required="no" condition="isMicroservicesDataManagementSelected"> -->
<!-- 			<description>REGARDS Data Management services installation</description> -->

<!-- 			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true"> -->
<!-- 				<include name="bootstrap-dam.jar" /> -->
<!-- 			</fileset> -->
<!-- 		</pack> -->
<!-- 		<pack name="catalog" required="no" condition="isMicroservicesCatalogSelected"> -->
<!-- 			<description>REGARDS Catalog services installation</description> -->

<!-- 			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true"> -->
<!-- 				<include name="bootstrap-catalog.jar" /> -->
<!-- 			</fileset> -->
<!-- 		</pack> -->
<!-- 		<pack name="access" required="no" condition="isMicroservicesAccessSelected"> -->
<!-- 			<description>REGARDS Access service installation</description> -->

<!-- 			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true"> -->
<!-- 				<include name="bootstrap-access.jar" /> -->
<!-- 			</fileset> -->
<!-- 		</pack> -->
<!-- 		<pack name="storage" required="no" condition="isMicroservicesStorageSelected"> -->
<!-- 			<description>REGARDS Storage service installation</description> -->

<!-- 			<fileset dir="lib/" targetdir="$INSTALL_PATH/REGARDS" override="true"> -->
<!-- 				<include name="bootstrap-storage.jar" /> -->
<!-- 			</fileset> -->
<!-- 		</pack> -->
	</packs>

</izpack:installation>
